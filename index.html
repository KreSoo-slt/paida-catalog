<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Paida All ‚Äî –ö–∞—Ç–∞–ª–æ–≥</title>
  <style>
    /* –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ */
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      margin: 0;
      padding: 1em;
    }
    
    /* –®–∞–ø–∫–∞ */
    header {
      background: #ffffff;
      padding: 1em;
      border-bottom: 1px solid #ddd;
      text-align: center;
    }
    
    /* –ö–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ */
    .cards-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 1em;
      padding: 0.5em;
    }
    
    .card {
      background: white;
      border-radius: 10px;
      padding: 1em;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
    }
    
    /* –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å */
    .admin-panel {
      background: #f0f0f0;
      padding: 1em;
      margin: 1em 0;
      border-radius: 8px;
    }
    
    /* –ú–æ–±–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è */
    @media (max-width: 600px) {
      .cards-container {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .admin-panel input {
        width: 100%;
        margin-bottom: 0.5em;
      }
    }
  </style>
</head>
<body>
  <a class="whatsapp-link" href="https://wa.me/77780855478" target="_blank">üí¨ WhatsApp</a>
  
  <header>
    <h1>Paida All</h1>
    <div class="contact">
      –≥. –ö–∞—Ä–∞–≥–∞–Ω–¥–∞, —É–ª. –ê–ª–∏—Ö–∞–Ω–æ–≤–∞ 37<br>
      –¢–µ–ª: 8 (778) 085-54-78
    </div>
  </header>

  <div class="admin-controls">
    <button id="adminToggle">–í–æ–π—Ç–∏ –∫–∞–∫ –∞–¥–º–∏–Ω</button>
    <div id="adminPanel" class="admin-panel" style="display:none">
      <h3>–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</h3>
      <input type="text" id="productName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
      <input type="text" id="productPrice" placeholder="–¶–µ–Ω–∞">
      <input type="text" id="productImage" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–æ—Ç–æ">
      <input type="text" id="productCategory" placeholder="–ö–∞—Ç–µ–≥–æ—Ä–∏—è">
      <button id="addProduct">–î–æ–±–∞–≤–∏—Ç—å</button>
    </div>
  </div>

  <div id="productsContainer" class="cards-container"></div>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Supabase
    const supabaseUrl = 'https://qmnnbotyzwftlhwakbnz.supabase.co'
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFtbm5ib3R5endmdGxod2FrYm56Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIwOTE3MzYsImV4cCI6MjA2NzY2NzczNn0.QaHkN4M4_Deh4HN4CZ-spv8QKbGKzhrfGwMvr6Pbyv4'
    const supabase = createClient(supabaseUrl, supabaseKey)
    
    // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
    const adminToggle = document.getElementById('adminToggle')
    const adminPanel = document.getElementById('adminPanel')
    const productsContainer = document.getElementById('productsContainer')
    const addProductBtn = document.getElementById('addProduct')
    
    // –°–æ—Å—Ç–æ—è–Ω–∏–µ
    let isAdmin = false
    const ADMIN_PASSWORD = "erema"
    
    // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤
    async function loadProducts() {
      const { data, error } = await supabase
        .from('products')
        .select('*')
        .order('order', { ascending: true })
      
      if (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error)
        return
      }
      
      renderProducts(data.filter(p => !p.archived))
    }
    
    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤
    function renderProducts(products) {
      productsContainer.innerHTML = ''
      
      products.forEach(product => {
        const productCard = document.createElement('div')
        productCard.className = 'card'
        productCard.innerHTML = `
          <img src="${product.img || 'https://via.placeholder.com/150'}" width="120">
          <h3>${product.name}</h3>
          <p>${product.price} ‚Ç∏</p>
          ${isAdmin ? `
            <button onclick="archiveProduct(${product.id})">–ê—Ä—Ö–∏–≤</button>
            <button onclick="deleteProduct(${product.id})">–£–¥–∞–ª–∏—Ç—å</button>
          ` : ''}
        `
        productsContainer.appendChild(productCard)
      })
    }
    
    // –ê–¥–º–∏–Ω-—Ñ—É–Ω–∫—Ü–∏–∏
    adminToggle.addEventListener('click', () => {
      const password = prompt('–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:')
      if (password === ADMIN_PASSWORD) {
        isAdmin = !isAdmin
        adminPanel.style.display = isAdmin ? 'block' : 'none'
        loadProducts()
      } else {
        alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!')
      }
    })
    
    addProductBtn.addEventListener('click', async () => {
      const name = document.getElementById('productName').value
      const price = document.getElementById('productPrice').value
      const img = document.getElementById('productImage').value || 'https://via.placeholder.com/150'
      const category = document.getElementById('productCategory').value || '–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏'
      
      if (!name || !price) {
        alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ —Ü–µ–Ω—É!')
        return
      }
      
      const { error } = await supabase
        .from('products')
        .insert([{ name, price, img, category, archived: false }])
      
      if (error) {
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏: ' + error.message)
      } else {
        loadProducts()
        document.getElementById('productName').value = ''
        document.getElementById('productPrice').value = ''
      }
    })
    
    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫
    window.archiveProduct = async (id) => {
      await supabase.from('products').update({ archived: true }).eq('id', id)
      loadProducts()
    }
    
    window.deleteProduct = async (id) => {
      if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ç–æ–≤–∞—Ä?')) {
        await supabase.from('products').delete().eq('id', id)
        loadProducts()
      }
    }
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    loadProducts()
  </script>
</body>
</html>
