<!--
–§–ò–ù–ê–õ–¨–ù–ê–Ø –í–ï–†–°–ò–Ø: –û–±—ä–µ–¥–∏–Ω—è–µ—Ç —Ä–∞–±–æ—á–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –∏–∑ –ø–µ—Ä–≤–æ–≥–æ –∏ –≤—Ç–æ—Ä–æ–≥–æ –∫–æ–¥–∞
–î–æ–±–∞–≤–ª–µ–Ω—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- —Ü–µ–Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç—Å—è –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –∫–Ω–æ–ø–∫–∏ "–ê—Ä—Ö–∏–≤", "–£–¥–∞–ª–∏—Ç—å", "–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å" —Ä–∞–±–æ—Ç–∞—é—Ç
- –ø–∞—Ä–æ–ª—å —Å–ø—Ä—è—Ç–∞–Ω –≤ ENV (–ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å —á–µ—Ä–µ–∑ Vercel)
-->

<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Paida All ‚Äî –ö–∞—Ç–∞–ª–æ–≥</title>
  <style>
    :root {
      --primary-color: #25D366;
      --admin-color: #ff4757;
    }
    body {
      font-family: Arial;
      margin: 0;
      background: #f0f0f0;
    }
    header { text-align: center; background: white; padding: 10px; position: relative; }
    .admin-access { position: absolute; right: 10px; top: 10px; cursor: pointer; color: var(--admin-color); font-size: 12px; text-decoration: underline; }
    .notice { background: #fff6b0; padding: 10px; text-align: center; font-size: 14px; }
    .categories { display: flex; overflow-x: auto; padding: 10px; background: white; }
    .category-btn { margin-right: 5px; padding: 5px 10px; border: none; border-radius: 10px; cursor: pointer; background: #eee; }
    .category-btn.active { background: var(--primary-color); color: white; }
    .products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px; padding: 10px; }
    .product-card { background: white; padding: 10px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .product-image { width: 100%; height: 100px; object-fit: contain; margin-bottom: 10px; }
    .product-name, .product-price { font-weight: bold; margin-bottom: 5px; }
    .product-price { color: green; }
    .admin-controls { margin-top: 5px; display: flex; gap: 5px; }
    .admin-controls button { padding: 3px 6px; font-size: 12px; border: none; border-radius: 5px; cursor: pointer; }
    .archive-btn { background: orange; color: white; }
    .delete-btn { background: red; color: white; }
    .move-btns { margin-top: 5px; display: flex; gap: 5px; justify-content: center; }
    .admin-panel, .archive-section { display: none; background: #fff; margin: 10px; padding: 10px; border-radius: 10px; }
    .admin-visible .admin-panel, .admin-visible .archive-section { display: block; }
    .whatsapp-btn { position: fixed; bottom: 20px; right: 20px; background: var(--primary-color); color: white; padding: 10px 15px; border-radius: 50px; text-decoration: none; }
  </style>
</head>
<body>
  <a class="whatsapp-btn" href="https://wa.me/77780855478" target="_blank">üí¨ WhatsApp</a>

  <header>
    <h1>Paida All</h1>
    <div class="contact">–≥. –ö–∞—Ä–∞–≥–∞–Ω–¥–∞, —É–ª. –ê–ª–∏—Ö–∞–Ω–æ–≤–∞ 37 (—Ü–æ–∫–æ–ª—å–Ω—ã–π —ç—Ç–∞–∂)<br>–¢–µ–ª: 8 (778) 085-54-78</div>
    <div class="admin-access" id="adminAccess">–î–ª—è –∞–¥–º–∏–Ω–∞</div>
  </header>

  <div class="notice">–ó–∞–∫–∞–∑—ã –ø–æ—Å–ª–µ 13:00 –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å. –î–æ—Å—Ç–∞–≤–∫–∞ –∏ —Å–∞–º–æ–≤—ã–≤–æ–∑ –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ –ö–∞—Ä–∞–≥–∞–Ω–¥–µ.</div>

  <div class="categories" id="categories">
    <button class="category-btn active" data-category="all">–í—Å–µ</button>
  </div>

  <div class="products-container">
    <div class="products-grid" id="productsGrid"></div>
  </div>

  <div class="archive-section" id="archiveSection">
    <div class="archive-title">üì¶ –ê—Ä—Ö–∏–≤</div>
    <div class="products-grid" id="archiveGrid"></div>
  </div>

  <div class="admin-panel" id="adminPanel">
    <h3>–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</h3>
    <input type="text" id="productName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
    <input type="text" id="productPrice" placeholder="–¶–µ–Ω–∞ (—Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã)">
    <input type="text" id="productImage" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–æ—Ç–æ">
    <input type="text" id="productCategory" placeholder="–ö–∞—Ç–µ–≥–æ—Ä–∏—è">
    <button id="addProductBtn">–î–æ–±–∞–≤–∏—Ç—å</button>
  </div>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
    const supabase = createClient(
      'https://qmnnbotyzwftlhwakbnz.supabase.co',
      import.meta.env.VITE_SUPABASE_KEY || ''
    );

    let isAdmin = false;
    let selectedCategory = 'all';
    let allProducts = [];
    const ADMIN_PASSWORD = import.meta.env.VITE_ADMIN_PASSWORD || '';

    document.getElementById('adminAccess').addEventListener('click', () => {
      const pw = prompt('–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å:');
      if (pw === ADMIN_PASSWORD) {
        isAdmin = true;
        document.body.classList.add('admin-visible');
        renderProducts();
      } else {
        alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å');
      }
    });

    document.getElementById('addProductBtn').addEventListener('click', async () => {
      const name = document.getElementById('productName').value;
      const price = parseInt(document.getElementById('productPrice').value.replace(/\D/g, ''));
      const img = document.getElementById('productImage').value || 'https://via.placeholder.com/150';
      const category = document.getElementById('productCategory').value;
      if (!name || !price || !category) return alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
      await supabase.from('products').insert([{ name, price, img, category, archived: false, order: allProducts.length + 1 }]);
      loadProducts();
    });

    async function loadProducts() {
      const { data } = await supabase.from('products').select('*').order('order', { ascending: true });
      allProducts = data || [];
      renderCategories();
      renderProducts();
    }

    function renderCategories() {
      const cats = [...new Set(allProducts.map(p => p.category).filter(Boolean))];
      const container = document.getElementById('categories');
      container.innerHTML = '<button class="category-btn active" data-category="all">–í—Å–µ</button>';
      cats.forEach(cat => {
        const btn = document.createElement('button');
        btn.className = 'category-btn';
        btn.dataset.category = cat;
        btn.textContent = cat;
        btn.onclick = () => {
          selectedCategory = cat;
          document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          renderProducts();
        };
        container.appendChild(btn);
      });
    }

    function renderProducts() {
      const grid = document.getElementById('productsGrid');
      const archiveGrid = document.getElementById('archiveGrid');
      grid.innerHTML = '';
      archiveGrid.innerHTML = '';
      allProducts.forEach(product => {
        const card = document.createElement('div');
        card.className = 'product-card';
        card.innerHTML = `
          <img src="${product.img}" class="product-image">
          <div class="product-name" contenteditable="${isAdmin}" onblur="updateProduct(${product.id}, 'name', this.textContent)">${product.name}</div>
          <div class="product-price" contenteditable="${isAdmin}" onblur="updateProduct(${product.id}, 'price', this.textContent)">${product.price} ‚Ç∏</div>
        `;
        if (isAdmin) {
          card.innerHTML += `
            <div class="admin-controls">
              <button class="${product.archived ? 'archive-btn' : 'delete-btn'}" onclick="${product.archived ? 'restoreProduct' : 'archiveProduct'}(${product.id})">
                ${product.archived ? '–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å' : '–ê—Ä—Ö–∏–≤'}
              </button>
              <button class="delete-btn" onclick="deleteProduct(${product.id})">–£–¥–∞–ª–∏—Ç—å</button>
            </div>
            <div class="move-btns">
              <button onclick="moveProduct(${product.id}, 'up')">‚Üë</button>
              <button onclick="moveProduct(${product.id}, 'down')">‚Üì</button>
            </div>`;
        }
        if (product.archived) archiveGrid.appendChild(card);
        else if (selectedCategory === 'all' || product.category === selectedCategory) grid.appendChild(card);
      });
    }

    window.updateProduct = async function(id, field, value) {
      const cleanValue = field === 'price' ? parseInt(value.replace(/\D/g, '')) : value.trim();
      await supabase.from('products').update({ [field]: cleanValue }).eq('id', id);
      const prod = allProducts.find(p => p.id === id);
      if (prod) prod[field] = cleanValue;
      renderProducts();
    };

    window.archiveProduct = async function(id) {
      await supabase.from('products').update({ archived: true }).eq('id', id);
      loadProducts();
    };

    window.restoreProduct = async function(id) {
      await supabase.from('products').update({ archived: false }).eq('id', id);
      loadProducts();
    };

    window.deleteProduct = async function(id) {
      await supabase.from('products').delete().eq('id', id);
      loadProducts();
    };

    window.moveProduct = async function(id, dir) {
      const index = allProducts.findIndex(p => p.id === id);
      if (index === -1) return;
      const swapIndex = dir === 'up' ? index - 1 : index + 1;
      if (swapIndex < 0 || swapIndex >= allProducts.length) return;
      const a = allProducts[index], b = allProducts[swapIndex];
      await supabase.from('products').upsert([
        { id: a.id, order: b.order },
        { id: b.id, order: a.order }
      ]);
      loadProducts();
    };

    window.onload = loadProducts;
  </script>
</body>
</html>
