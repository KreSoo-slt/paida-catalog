<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Paida All ‚Äî –ö–∞—Ç–∞–ª–æ–≥</title>
  <style>
    :root {
      --primary-color: #25D366;
      --admin-color: #ff4757;
    }
    
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      margin: 0;
      padding: 0;
    }
    
    /* –®–∞–ø–∫–∞ */
    header {
      background: white;
      padding: 15px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      text-align: center;
      margin-bottom: 10px;
    }
    
    /* –ö–Ω–æ–ø–∫–∞ WhatsApp */
    .whatsapp-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: var(--primary-color);
      color: white;
      padding: 12px 20px;
      border-radius: 50px;
      text-decoration: none;
      font-weight: bold;
      display: flex;
      align-items: center;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      z-index: 100;
    }
    
    .whatsapp-btn::before {
      content: "üí¨";
      margin-right: 8px;
      font-size: 20px;
    }
    
    /* –ê–¥–º–∏–Ω-–∫–Ω–æ–ø–∫–∞ */
    .admin-btn {
      position: fixed;
      bottom: 20px;
      left: 20px;
      background: var(--admin-color);
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
      z-index: 100;
    }
    
    /* –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ */
    .categories {
      display: flex;
      overflow-x: auto;
      padding: 10px;
      background: white;
      margin-bottom: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    
    .category-btn {
      padding: 8px 15px;
      margin-right: 10px;
      border: none;
      border-radius: 20px;
      background: #f1f1f1;
      cursor: pointer;
      white-space: nowrap;
    }
    
    .category-btn.active {
      background: var(--primary-color);
      color: white;
    }
    
    /* –ö–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ */
    .products-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 15px;
      padding: 10px;
    }
    
    .product-card {
      background: white;
      border-radius: 10px;
      padding: 15px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      position: relative;
    }
    
    .product-image {
      width: 100%;
      height: 120px;
      object-fit: contain;
      border-radius: 5px;
      margin-bottom: 10px;
    }
    
    .product-name {
      font-weight: bold;
      margin-bottom: 5px;
      word-break: break-word;
    }
    
    .product-price {
      color: #2ecc71;
      font-weight: bold;
    }
    
    /* –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å */
    .admin-panel {
      background: #f8f9fa;
      padding: 15px;
      margin: 10px;
      border-radius: 10px;
      display: none;
    }
    
    .admin-visible .admin-panel {
      display: block;
    }
    
    .admin-controls {
      margin-top: 10px;
      display: flex;
      gap: 5px;
    }
    
    .admin-controls button {
      padding: 5px 10px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 12px;
    }
    
    .archive-btn {
      background: #ffa502;
      color: white;
    }
    
    .delete-btn {
      background: var(--admin-color);
      color: white;
    }
    
    .move-btns {
      display: flex;
      justify-content: center;
      gap: 5px;
      margin-top: 5px;
    }
    
    /* –ê—Ä—Ö–∏–≤ */
    .archive-section {
      display: none;
      margin-top: 20px;
      padding: 10px;
    }
    
    .admin-visible .archive-section {
      display: block;
    }
    
    /* –ê–¥–∞–ø—Ç–∞—Ü–∏—è */
    @media (max-width: 600px) {
      .products-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .whatsapp-btn {
        bottom: 70px;
        right: 10px;
        padding: 10px 15px;
      }
    }
  </style>
</head>
<body>
  <!-- WhatsApp –∫–Ω–æ–ø–∫–∞ -->
  <a class="whatsapp-btn" href="https://wa.me/77780855478" target="_blank">WhatsApp</a>
  
  <!-- –ö–Ω–æ–ø–∫–∞ –∞–¥–º–∏–Ω–∞ -->
  <button class="admin-btn" id="adminToggle">–ê–¥–º–∏–Ω</button>
  
  <!-- –®–∞–ø–∫–∞ -->
  <header>
    <h1>Paida All</h1>
    <div class="contact">
      –≥. –ö–∞—Ä–∞–≥–∞–Ω–¥–∞, —É–ª. –ê–ª–∏—Ö–∞–Ω–æ–≤–∞ 37 (—Ü–æ–∫–æ–ª—å–Ω—ã–π —ç—Ç–∞–∂)<br>
      –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã: 13:00‚Äì20:00<br>
      –¢–µ–ª: 8 (778) 085-54-78
    </div>
  </header>
  
  <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ -->
  <div class="notice">
    –ó–∞–∫–∞–∑—ã –ø–æ—Å–ª–µ 19:00 –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å.<br>
    –î–æ—Å—Ç–∞–≤–∫–∞ –∏ —Å–∞–º–æ–≤—ã–≤–æ–∑ –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ –ö–∞—Ä–∞–≥–∞–Ω–¥–µ.
  </div>
  
  <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
  <div class="categories" id="categories">
    <button class="category-btn active" data-category="all">–í—Å–µ</button>
    <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
  </div>
  
  <!-- –¢–æ–≤–∞—Ä—ã -->
  <div class="products-grid" id="productsGrid"></div>
  
  <!-- –ê—Ä—Ö–∏–≤ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∞) -->
  <div class="archive-section" id="archiveSection">
    <h3>üì¶ –ê—Ä—Ö–∏–≤</h3>
    <div class="products-grid" id="archiveGrid"></div>
  </div>
  
  <!-- –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å -->
  <div class="admin-panel" id="adminPanel">
    <h3>–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</h3>
    <input type="text" id="productName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" style="width:100%; margin-bottom:10px; padding:8px;">
    <input type="text" id="productPrice" placeholder="–¶–µ–Ω–∞" style="width:100%; margin-bottom:10px; padding:8px;">
    <input type="text" id="productImage" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–æ—Ç–æ" style="width:100%; margin-bottom:10px; padding:8px;">
    <input type="text" id="productCategory" placeholder="–ö–∞—Ç–µ–≥–æ—Ä–∏—è" style="width:100%; margin-bottom:10px; padding:8px;">
    <button id="addProductBtn" style="width:100%; padding:10px; background:var(--primary-color); color:white; border:none; border-radius:5px;">–î–æ–±–∞–≤–∏—Ç—å</button>
  </div>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'
    
    const supabaseUrl = 'https://qmnnbotyzwftlhwakbnz.supabase.co'
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFtbm5ib3R5endmdGxod2FrYm56Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIwOTE3MzYsImV4cCI6MjA2NzY2NzczNn0.QaHkN4M4_Deh4HN4CZ-spv8QKbGKzhrfGwMvr6Pbyv4'
    const supabase = createClient(supabaseUrl, supabaseKey)
    
    // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
    const adminToggle = document.getElementById('adminToggle')
    const adminPanel = document.getElementById('adminPanel')
    const productsGrid = document.getElementById('productsGrid')
    const archiveGrid = document.getElementById('archiveGrid')
    const categoriesContainer = document.getElementById('categories')
    const archiveSection = document.getElementById('archiveSection')
    
    // –°–æ—Å—Ç–æ—è–Ω–∏–µ
    let isAdmin = false
    const ADMIN_PASSWORD = "erema"
    let selectedCategory = "all"
    let allProducts = []
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    document.addEventListener('DOMContentLoaded', () => {
      loadProducts()
      setupEventListeners()
    })
    
    // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤
    async function loadProducts() {
      const { data, error } = await supabase
        .from('products')
        .select('*')
        .order('order', { ascending: true })
      
      if (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error)
        return
      }
      
      allProducts = data
      updateCategories()
      renderProducts()
    }
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
    function updateCategories() {
      // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
      const categories = [...new Set(allProducts.map(p => p.category))]
      
      // –û—á–∏—â–∞–µ–º –∏ –¥–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
      categoriesContainer.innerHTML = `
        <button class="category-btn active" data-category="all">–í—Å–µ</button>
        ${categories.map(cat => `
          <button class="category-btn" data-category="${cat}">${cat}</button>
        `).join('')}
      `
      
      // –ù–∞–∑–Ω–∞—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
      document.querySelectorAll('.category-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          selectedCategory = btn.dataset.category
          document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'))
          btn.classList.add('active')
          renderProducts()
        })
      })
    }
    
    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤
    function renderProducts() {
      // –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–≤–∞—Ä—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –∞—Ä—Ö–∏–≤—É
      const activeProducts = allProducts.filter(p => 
        !p.archived && (selectedCategory === "all" || p.category === selectedCategory)
      )
      
      const archivedProducts = allProducts.filter(p => p.archived)
      
      // –†–µ–Ω–¥–µ—Ä–∏–º –∞–∫—Ç–∏–≤–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
      productsGrid.innerHTML = activeProducts.map(product => `
        <div class="product-card" data-id="${product.id}">
          <img src="${product.img || 'https://via.placeholder.com/150'}" class="product-image">
          <div class="product-name" contenteditable="${isAdmin}" onblur="updateProductField(${product.id}, 'name', this.textContent)">${product.name}</div>
          <div class="product-price" contenteditable="${isAdmin}" onblur="updateProductField(${product.id}, 'price', this.textContent)">${product.price} ‚Ç∏</div>
          
          ${isAdmin ? `
            <div class="admin-controls">
              <button class="archive-btn" onclick="toggleArchive(${product.id}, true)">–ê—Ä—Ö–∏–≤</button>
              <button class="delete-btn" onclick="deleteProduct(${product.id})">–£–¥–∞–ª–∏—Ç—å</button>
            </div>
            <div class="move-btns">
              <button onclick="moveProduct(${product.id}, 'up')">‚Üë</button>
              <button onclick="moveProduct(${product.id}, 'down')">‚Üì</button>
            </div>
          ` : ''}
        </div>
      `).join('')
      
      // –†–µ–Ω–¥–µ—Ä–∏–º –∞—Ä—Ö–∏–≤ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∞)
      if (isAdmin) {
        archiveGrid.innerHTML = archivedProducts.map(product => `
          <div class="product-card" data-id="${product.id}">
            <img src="${product.img || 'https://via.placeholder.com/150'}" class="product-image">
            <div class="product-name">${product.name}</div>
            <div class="product-price">${product.price} ‚Ç∏</div>
            <div class="admin-controls">
              <button class="archive-btn" onclick="toggleArchive(${product.id}, false)">–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
              <button class="delete-btn" onclick="deleteProduct(${product.id})">–£–¥–∞–ª–∏—Ç—å</button>
            </div>
          </div>
        `).join('')
      }
    }
    
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
    function setupEventListeners() {
      // –ê–¥–º–∏–Ω-—Ä–µ–∂–∏–º
      adminToggle.addEventListener('click', () => {
        if (isAdmin) {
          isAdmin = false
          document.body.classList.remove('admin-visible')
        } else {
          const password = prompt('–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:')
          if (password === ADMIN_PASSWORD) {
            isAdmin = true
            document.body.classList.add('admin-visible')
            renderProducts()
          } else {
            alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!')
          }
        }
      })
      
      // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
      document.getElementById('addProductBtn').addEventListener('click', async () => {
        const name = document.getElementById('productName').value
        const price = document.getElementById('productPrice').value
        const img = document.getElementById('productImage').value
        const category = document.getElementById('productCategory').value
        
        if (!name || !price || !category) {
          alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ, —Ü–µ–Ω—É –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—é!')
          return
        }
        
        const { error } = await supabase
          .from('products')
          .insert([{ 
            name, 
            price, 
            img: img || 'https://via.placeholder.com/150',
            category,
            archived: false,
            order: allProducts.length + 1
          }])
        
        if (error) {
          alert('–û—à–∏–±–∫–∞: ' + error.message)
        } else {
          document.getElementById('productName').value = ''
          document.getElementById('productPrice').value = ''
          document.getElementById('productImage').value = ''
          document.getElementById('productCategory').value = ''
          loadProducts()
        }
      })
    }
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª—è —Ç–æ–≤–∞—Ä–∞
    window.updateProductField = async (id, field, value) => {
      const { error } = await supabase
        .from('products')
        .update({ [field]: field === 'price' ? value.replace(/[^\d]/g, '') : value })
        .eq('id', id)
      
      if (error) {
        console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:', error)
        loadProducts() // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º, –µ—Å–ª–∏ –æ—à–∏–±–∫–∞
      }
    }
    
    // –ê—Ä—Ö–∏–≤–∞—Ü–∏—è/–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
    window.toggleArchive = async (id, archive) => {
      const { error } = await supabase
        .from('products')
        .update({ archived: archive })
        .eq('id', id)
      
      if (!error) loadProducts()
    }
    
    // –£–¥–∞–ª–µ–Ω–∏–µ
    window.deleteProduct = async (id) => {
      if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ç–æ–≤–∞—Ä?')) {
        const { error } = await supabase
          .from('products')
          .delete()
          .eq('id', id)
        
        if (!error) loadProducts()
      }
    }
    
    // –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
    window.moveProduct = async (id, direction) => {
      const product = allProducts.find(p => p.id === id)
      if (!product) return
      
      const categoryProducts = allProducts
        .filter(p => p.category === product.category && !p.archived)
        .sort((a, b) => a.order - b.order)
      
      const currentIndex = categoryProducts.findIndex(p => p.id === id)
      
      if (direction === 'up' && currentIndex > 0) {
        const prevProduct = categoryProducts[currentIndex - 1]
        // –ú–µ–Ω—è–µ–º –ø–æ—Ä—è–¥–æ–∫
        await supabase
          .from('products')
          .update({ order: prevProduct.order })
          .eq('id', product.id)
        
        await supabase
          .from('products')
          .update({ order: product.order })
          .eq('id', prevProduct.id)
        
        loadProducts()
      }
      else if (direction === 'down' && currentIndex < categoryProducts.length - 1) {
        const nextProduct = categoryProducts[currentIndex + 1]
        // –ú–µ–Ω—è–µ–º –ø–æ—Ä—è–¥–æ–∫
        await supabase
          .from('products')
          .update({ order: nextProduct.order })
          .eq('id', product.id)
        
        await supabase
          .from('products')
          .update({ order: product.order })
          .eq('id', nextProduct.id)
        
        loadProducts()
      }
    }
  </script>
</body>
</html>
